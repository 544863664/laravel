(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22ce2f14"],{"24db":function(e,t,i){"use strict";var a=i("2729"),l=i.n(a);l.a},2729:function(e,t,i){},"30e7":function(e,t,i){"use strict";var a=i("df29"),l=i.n(a);l.a},"9cff":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{staticClass:"Productiondialog1",attrs:{visible:e.UpfileDialogVisible.dialog,title:"上传质检报告",top:"8vh","close-on-click-modal":!1,width:1==e.UpfileDialogVisible.obj.t?"560px":"900px"},on:{"update:visible":function(t){return e.$set(e.UpfileDialogVisible,"dialog",t)},close:e.close}},[1==e.UpfileDialogVisible.obj.t?i("div",{staticClass:"Batchdialog"},[i("el-form",{staticClass:"demo-ruleForm",attrs:{"label-width":"110px"}},[i("el-form-item",{attrs:{label:"名称："}},[i("el-input",{attrs:{disabled:""},model:{value:e.UpfileDialogVisible.obj.product_name,callback:function(t){e.$set(e.UpfileDialogVisible.obj,"product_name",t)},expression:"UpfileDialogVisible.obj.product_name"}})],1),i("el-form-item",{attrs:{label:"代号："}},[i("el-input",{attrs:{disabled:""},model:{value:e.UpfileDialogVisible.obj.item,callback:function(t){e.$set(e.UpfileDialogVisible.obj,"item",t)},expression:"UpfileDialogVisible.obj.item"}})],1),i("el-form-item",{attrs:{label:"数量："}},[i("el-input",{attrs:{disabled:""},model:{value:e.UpfileDialogVisible.obj.number,callback:function(t){e.$set(e.UpfileDialogVisible.obj,"number",t)},expression:"UpfileDialogVisible.obj.number"}})],1),i("el-form-item",{attrs:{label:"工序："}},[i("el-input",{attrs:{disabled:""},model:{value:e.UpfileDialogVisible.obj.procedure_name,callback:function(t){e.$set(e.UpfileDialogVisible.obj,"procedure_name",t)},expression:"UpfileDialogVisible.obj.procedure_name"}})],1),i("el-form-item",{attrs:{label:"生产编号："}},[i("el-input",{attrs:{disabled:""},model:{value:e.UpfileDialogVisible.obj.procedure_detail_number,callback:function(t){e.$set(e.UpfileDialogVisible.obj,"procedure_detail_number",t)},expression:"UpfileDialogVisible.obj.procedure_detail_number"}})],1),i("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"上传附件：",required:""}},[i("el-upload",{staticStyle:{"line-height":"1"},attrs:{drag:"",action:"",limit:1,"show-file-list":!0,"file-list":e.fileList,"before-upload":e.beforeUpload,"on-remove":e.handleRemove}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text",staticStyle:{"line-height":"1"}},[e._v("将文件拖到此处或"),i("em",[e._v("点击上传")])]),i("div",{staticClass:"el-upload__tip",staticStyle:{"line-height":"1","margin-top":"0"},attrs:{slot:"tip"},slot:"tip"},[0==e.photoimglist.length&&0==e.fileList.length?i("el-button",{staticStyle:{width:"auto !important"},attrs:{type:"text"},on:{click:function(t){e.cropperPhoto.dialog=!0}}},[e._v("拍照")]):e._e(),e.photoimglist.length?i("div",{staticClass:"photolist"},[i("div",{staticClass:"list",style:"width: calc(55px *"+e.photoimglist.length+");"},e._l(e.photoimglist,function(t,a){return i("div",{key:a,staticClass:"imglist"},[i("i",{staticClass:"el-icon-error",on:{click:function(i){return e.handleClose(t)}}}),"pdf"==t.slice(-3)?i("el-popover",{attrs:{placement:"left",title:"",trigger:"hover"}},[i("iframe",{attrs:{width:"500",height:"750",src:t}}),i("iframe",{staticStyle:{height:"50px",width:"50px","min-height":"50px","min-width":"50px"},attrs:{slot:"reference",width:"50",height:"50",src:t},slot:"reference"})]):i("el-popover",{attrs:{placement:"left",title:"",trigger:"hover"}},[i("img",{staticStyle:{height:"500px"},attrs:{src:t}}),i("img",{staticStyle:{height:"50px",width:"50px","min-height":"50px","min-width":"50px"},attrs:{slot:"reference",src:t,alt:""},slot:"reference"})])],1)}),0)]):e._e()],1)])],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",disabled:e.uBtn},on:{click:e.postBatch}},[e._v("提交")])],1)],1)],1):e._e(),2==e.UpfileDialogVisible.obj.t?i("div",{staticClass:"Singledialog"},[i("el-table",{ref:"singleTableData",attrs:{data:e.singleTableData.tableData},on:{"row-click":e.changeRowClick}},[i("el-table-column",{attrs:{label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.task_id||"-- --"))])]}}],null,!1,2950292569)}),i("el-table-column",{attrs:{label:"零件名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.product_name||"-- --"))])]}}],null,!1,147762005)}),i("el-table-column",{attrs:{label:"零件编码",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.parts_number||"-- --"))])]}}],null,!1,2205784094)}),i("el-table-column",{attrs:{label:"数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.number||"-- --"))])]}}],null,!1,2931692485)}),i("el-table-column",{attrs:{label:"批次"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.batch||"-- --"))])]}}],null,!1,843810746)}),i("el-table-column",{attrs:{label:"附件",align:"center",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.presen_url?i("span",[t.row.pdf?i("el-popover",{attrs:{placement:"left",title:"",trigger:"click"}},[i("iframe",{attrs:{width:"500",height:"750",src:t.row.presen_url}}),i("el-link",{attrs:{slot:"reference",underline:!1,type:"primary"},slot:"reference"},[e._v("查看")])],1):i("el-popover",{attrs:{placement:"left",title:"",trigger:"click"}},[i("img",{staticStyle:{height:"500px"},attrs:{src:t.row.presen_url||e.nullImg}}),i("el-link",{attrs:{slot:"reference",underline:!1,type:"primary"},slot:"reference"},[e._v("查看")])],1),i("el-link",{attrs:{underline:!1,type:"danger"},on:{click:function(i){return e.deletfile(t.row)}}},[i("i",{staticClass:"el-icon-error",staticStyle:{"margin-left":"5px"}})])],1):i("span",[i("el-upload",{staticClass:"upload-demo",attrs:{action:"","show-file-list":!1,"before-upload":e.beforeUpload}},[i("el-button",{attrs:{size:"mini",type:"text"}},[e._v("上传附件")])],1)],1)]}}],null,!1,787896268)})],1),i("div",{staticClass:"block"},[e.singleTableData.total>10?i("el-pagination",{attrs:{layout:"prev, pager, next, jumper",total:e.singleTableData.total},on:{"current-change":e.handleCurrentChange}}):e._e()],1)],1):e._e()]),i("cropperPhoto",{attrs:{centerDialogVisible:e.cropperPhoto.dialog},on:{change:e.changeClose}})],1)},l=[],s=(i("7f7f"),i("cebc")),o=i("2f62"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{visible:e.centerDialogVisible,"close-on-click-modal":!1,"before-close":e.close,width:"800px"},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[i("div",{staticClass:"Record"},[i("article",[i("section",{staticClass:"experiment"},[i("div",{attrs:{id:"videos-container"}})]),i("section",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"experiment"},[i("canvas",{attrs:{id:"canvasCamera",width:"320",height:"240"}})]),i("section",{directives:[{name:"show",rawName:"v-show",value:e.imgSrc,expression:"imgSrc"}],staticClass:"imglist"},e._l(e.filesArr,function(t,a){return i("div",{key:a,staticClass:"list"},[i("i",{staticClass:"el-icon-error",on:{click:function(i){return e.handleClose(t)}}}),i("img",{attrs:{src:t,alt:""}})])}),0),i("section",{staticClass:"experimentbtn"},[i("el-button",{on:{click:e.setRecording}},[e._v("拍照")]),e.filesArr.length?i("el-button",{attrs:{disabled:e.viewBtn},on:{click:e.closeview}},[e._v("完成")]):e._e()],1)])])])],1)},r=[],c=(i("34ef"),i("4917"),i("28a5"),{data:function(){return{mediaStream:"",recorderFile:"",stopRecordCallback:"",mediaRecorder:{blobs:[]},openBtn:{disabled:!1},startBtn:{disabled:!0,start:!1},saveBtn:{disabled:!0},stopBtn:!1,startTimeOut:"",startInterval:"",imgSrc:"",imageFiles:{},filesArr:[],filelist:{start:!1,fileimgurl:{url:""}},myCropper:null,afterImg:"",viewBtn:!1}},computed:Object(s["a"])({},Object(o["c"])({url:function(e){return e.url}}),Object(o["b"])({token:"getToken"})),props:{centerDialogVisible:""},watch:{centerDialogVisible:function(){var e=this;setTimeout(function(){e.openCameraBtn()},100)}},methods:{openCameraBtn:function(){this.openBtn.disabled=!0,this.startBtn.disabled=!1,this.openCamera()},setRecording:function(){this.setImage()},setImage:function(){var e=document.getElementById("canvasCamera"),t=e.getContext("2d"),i=document.getElementById("video0");t.drawImage(i,0,0,318,238);var a=e.toDataURL("image/png");this.imgSrc=a,a&&this.filesArr.push(a)},openCamera:function(){for(var e=document.getElementById("videos-container"),t=e.childNodes.length,i=0;i<t;i++)e.removeChild(e.childNodes[i]);var a=document.createElement("video"),l=320,s=238;a.controls=!1,a.muted=!0,a.width=l,a.height=s,a.id="video0";var o=this;o.getUserMedia(!0,!1,function(t,i){if(t)throw t;console.log(),o.mediaRecorder=new MediaRecorder(i),o.mediaStream=i;var l=[];a.srcObject=i,a.play(),e.appendChild(a),o.mediaRecorder.ondataavailable=function(e){o.mediaRecorder.blobs.push(e.data),l.push(e.data)},o.mediaRecorder.blobs=[],o.mediaRecorder.onstop=function(e){o.recorderFile=new Blob(l,{type:o.mediaRecorder.mimeType}),l=[],null!=o.stopRecordCallback&&o.stopRecordCallback()}})},getUserMedia:function(e,t,i){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;var a={video:e,audio:t};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(function(e){i(!1,e)})["catch"](function(e){i(e)}):navigator.getUserMedia?navigator.getUserMedia(a,function(e){i(!1,e)},function(e){i(e)}):i(new Error("Not support userMedia"))},dataURLtoFile:function(e,t){var i=e.split(","),a=i[0].match(/:(.*?);/)[1],l=atob(i[1]),s=l.length,o=new Uint8Array(s);while(s--)o[s]=l.charCodeAt(s);return new File([o],t,{type:a})},close:function(){this.imgSrc="",this.filesArr=[],this.$emit("change",this.filelist),clearInterval(this.startInterval),clearTimeout(this.startTimeOut),this.openBtn.disabled=!1,this.stopBtn=!1,this.viewBtn=!1,this.startBtn.start=!1,this.startBtn.disabled=!0,this.filelist.fileimgurl.url=""},closeview:function(){this.filesArr.length&&(this.viewBtn=!0,this.update(this.filesArr))},handleClose:function(e){this.filesArr.splice(this.filesArr.indexOf(e),1)},update:function(e){var t=this,i=this;i.axios({method:"POST",url:i.url+"/api/v1/supplier/uploadPdf",data:{image:e},headers:{"content-type":"application/json",token:i.token}}).then(function(e){e&&200==e.data.code&&(i.filelist.fileimgurl.url=e.data.data.url,i.close())}).catch(function(e){console.log(e),t.viewBtn=!1})}}}),d=c,p=(i("30e7"),i("2877")),u=Object(p["a"])(d,n,r,!1,null,"33398212",null),f=u.exports,g={name:"Upfiledialog",components:{cropperPhoto:f},computed:Object(s["a"])({},Object(o["c"])({url:function(e){return e.url}}),Object(o["b"])({token:"getToken"})),props:{UpfileDialogVisible:""},data:function(){return{tab:1,fileList:[],photoimglist:[],obj:{},ids:"",singleTableData:{tableData:[],currentPage:1,pageSize:10,total:0},row:{},nullImg:"http://zrui.e7vr.com/image/arm/default.gif",cropperPhoto:{dialog:!1},uBtn:!0}},methods:{clickTab:function(e){this.tab=e,2==e&&this.getSingle(this.UpfileDialogVisible.obj.id)},getSingle:function(e){var t=this;t.axios({method:"POST",url:t.url+"/api/v1/supplier/task-detail",data:"",params:{page:t.singleTableData.currentPage,size:t.singleTableData.pageSize,task_id:e||t.UpfileDialogVisible.obj.id},headers:{"content-type":"application/json",token:t.token}}).then(function(e){if(e&&e.data&&e.data.data&&200==e.data.code){var i=e.data.data.list;t.singleTableData.total=e.data.data.count.total,i.map(function(e,t){return e.fileList0?e.fileList0=e.fileList0:e.fileList0="",e.pdf=!1,e.presen_url&&("pdf"==e.presen_url.slice(-3)&&(e.pdf=!0),"http:"==e.presen_url.slice(0,5)&&(e.presen_url=e.presen_url.slice(0,4)+"s"+e.presen_url.slice(4))),e.index_=t,e}),t.singleTableData.tableData=i}}).catch(function(e){console.log(e)})},handleCurrentChange:function(e){this.singleTableData.currentPage=e,this.getSingle()},changeRowClick:function(e,t,i){this.row=e},beforeUpload:function(e){1==this.UpfileDialogVisible.obj.t?this.update(e):2==this.UpfileDialogVisible.obj.t&&this.update1(e)},postBatch:function(){var e=this;if(e.fileList[0]||e.photoimglist[0]){var t={};1==e.UpfileDialogVisible.obj.u?(t={product_id:e.UpfileDialogVisible.obj.product_id,presen_url:e.photoimglist[0]||e.fileList[0].url},e.axios({method:"GET",url:e.url+"/api/v1/supplier/upload-many",data:"",params:t,headers:{"content-type":"application/json",token:e.token}}).then(function(t){t&&200==t.data.code&&(e.$message({message:"操作成功",type:"success",offset:300}),e.close())}).catch(function(t){console.log(t),e.uBtn=!0})):(t={type:1,task_id:e.UpfileDialogVisible.obj.id,parts_id:"",presen_url:e.photoimglist[0]||e.fileList[0].url},e.axios({method:"POST",url:e.url+"/api/v1/supplier/task-update",data:"",params:t,headers:{"content-type":"application/json",token:e.token}}).then(function(t){t&&200==t.data.code&&(e.$message({message:"操作成功",type:"success",offset:300}),e.close())}).catch(function(t){console.log(t),e.uBtn=!0}))}else e.$message({message:"请上传附件",type:"warning",offset:300})},handleRemove:function(e,t){this.fileList=[],this.uBtn=!0},update:function(e){var t=this,i=new FormData;i.append("file",e),t.axios.post(t.url+"/api/v1/upload",i,{headers:{"content-type":"application/x-www-form-urlencoded",token:t.token}}).then(function(i){if(i&&i.data&&i.data.data&&200==i.data.code){var a=i.data.data.url;"http:"==a.slice(0,5)&&(a=a.slice(0,4)+"s"+a.slice(4)),t.fileList.push({name:e.name,url:a}),t.uBtn=!1}}).catch(function(e){console.log(e),t.$message({message:"请重新上传",type:"warning",offset:300}),t.uBtn=!0})},postSingle:function(){var e=this;if(e.row.fileList0){var t={type:2,task_id:e.row.task_id,parts_id:e.row.id,presen_url:e.row.fileList0};e.axios({method:"POST",url:e.url+"/api/v1/supplier/task-update",data:"",params:t,headers:{"content-type":"application/json",token:e.token}}).then(function(t){t&&200==t.data.code&&(e.$message({message:"操作成功",type:"success",offset:300}),e.getSingle())}).catch(function(e){console.log(e)})}else e.$message({message:"请上传附件",type:"warning",offset:300})},update1:function(e){var t=this,i=new FormData;i.append("file",e),t.axios.post(t.url+"/api/v1/upload",i,{headers:{"content-type":"application/x-www-form-urlencoded",token:t.token}}).then(function(e){if(e&&e.data&&e.data.data&&200==e.data.code){var i=e.data.data.url;"http:"==i.slice(0,5)&&(i=i.slice(0,4)+"s"+i.slice(4)),t.singleTableData.tableData[t.row.index_].presen_url=i,t.singleTableData.tableData[t.row.index_].fileList0=i,t.postSingle()}}).catch(function(e){console.log(e)})},deletfile:function(e){var t=this,i=this.$createElement;t.$msgbox({title:"提示-删除附件",message:i("p",null,[i("span",null,"确认要删除编号"),i("span",{style:"color: teal"},e.task_id),i("span",null,"编码"),i("span",{style:"color: teal"},e.parts_number),i("span",null,"名称"),i("span",{style:"color: teal"},e.product_name),i("span",null,"的附件")]),showClose:!1,showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(e,t,i){"confirm"===e?(t.confirmButtonLoading=!0,t.confirmButtonText="删除中...",setTimeout(function(){i(),setTimeout(function(){t.confirmButtonLoading=!1},300)},1e3)):i()}}).then(function(i){t.axios({method:"POST",url:t.url+"/api/v1/supplier/task-preview",params:{type:2,task_id:e.task_id,parts_id:e.id,handle_type:2},headers:{"content-type":"application/json",token:t.token}}).then(function(e){e&&e.data&&200==e.data.code&&(t.$message({showClose:!0,message:"操作成功",type:"success"}),t.getSingle())}).catch(function(e){console.log(e)})})},handleClose:function(e){this.photoimglist.splice(this.photoimglist.indexOf(e),1)},changeClose:function(e){if(e.fileimgurl.url){var t=e.fileimgurl.url;"http:"==t.slice(0,5)&&(t=t.slice(0,4)+"s"+t.slice(4)),this.photoimglist.push(t)}this.cropperPhoto.dialog=e.start},close:function(){this.singleTableData.tableData=[],this.fileList=[],this.photoimglist=[],this.tab=1,this.uBtn=!0,this.$emit("change",!1)}}},h=g,m=(i("24db"),Object(p["a"])(h,a,l,!1,null,"7ea80391",null));t["a"]=m.exports},df29:function(e,t,i){}}]);