(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70271b78"],{"0696":function(e,t,l){},"0936":function(e,t,l){},"624d":function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"Production"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableData.loading,expression:"tableData.loading "}],attrs:{data:e.tableData.tableList,"header-cell-style":e.tableheader,"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),l("el-table-column",{attrs:{label:"计划编号","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.id||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-popover",{attrs:{placement:"right-start",width:"400",trigger:"click"}},[l("el-table",{attrs:{data:t.row.parts_list,height:"300",size:"mini"}},[l("el-table-column",{attrs:{label:"名称",property:"product_name"}}),l("el-table-column",{attrs:{label:"条码",property:"parts_number",width:"90"}}),l("el-table-column",{attrs:{label:"数量",property:"number",width:"70"}})],1),l("el-link",{attrs:{slot:"reference",underline:!1},slot:"reference"},[e._v(e._s(t.row.product_name||"-- --"))])],1)]}}])}),l("el-table-column",{attrs:{label:"代号"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.item||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"型号规格"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.specs||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"工序名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.procedure_name||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"工序",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.procedure_detail_number||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"批次",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.batch||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"数量",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(t.row.number||"-- --"))])]}}])}),l("el-table-column",{attrs:{label:"生产日期",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(e._f("formatDate")(t.row.created_at)))])]}}])}),l("el-table-column",{attrs:{label:"状态",align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.status?l("el-link",{attrs:{underline:!1,type:"danger"}},[e._v("未开始")]):e._e(),2==t.row.status?l("el-link",{attrs:{underline:!1,type:"warning"}},[e._v("生产中")]):e._e(),3==t.row.status?l("el-link",{attrs:{underline:!1,type:""}},[e._v("已完成")]):e._e(),4==t.row.status?l("el-link",{attrs:{underline:!1,type:"success"}},[e._v("已配送")]):e._e()]}}])}),l("el-table-column",{attrs:{label:"质检报告",width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status<3?l("el-link",{attrs:{underline:!1,type:"primary",disabled:t.row.status>=3},on:{click:function(l){return e.Upfile(t.row)}}},[e._v("上传")]):l("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(l){return e.Upfile(t.row)}}},[e._v("查看")])]}}])}),l("el-table-column",{attrs:{label:"操作",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){return[2==t.row.product_type?l("el-link",{attrs:{underline:!1,type:"primary"},on:{click:function(l){return e.downCode(t.row.id,1)}}},[e._v("图")]):e._e(),2==t.row.product_type?l("el-link",{staticStyle:{margin:"0 10px"},attrs:{underline:!1,type:"primary"},on:{click:function(l){return e.downCode(t.row.id,2)}}},[e._v("码")]):e._e(),4==t.row.status?l("el-link",{attrs:{underline:!1,type:"success"}},[e._v("已发货")]):l("el-link",{attrs:{underline:!1,type:3==t.row.status?"":"info",disabled:3!=t.row.status},on:{click:function(l){return e.delivergoods(t.row)}}},[e._v("发货")])]}}])})],1),l("div",{staticClass:"block"},[e.tableData.total>15?l("el-pagination",{attrs:{"page-sizes":[15,30,50,100],"page-size":e.tableData.pageSize,layout:"sizes, prev, pager, next",total:e.tableData.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}):e._e(),e.codeBtnshow?l("div",{staticClass:"downodebtn"},[l("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.allDownCode(1)}}},[e._v("批量下载图")]),l("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.allDownCode(2)}}},[e._v("批量下载码")])],1):e._e()],1),l("Upfiledialog",{ref:"upfile",attrs:{UpfileDialogVisible:e.UpfileDialogVisible},on:{change:e.UpfileClose}}),l("Deliverdialog",{ref:"deliver",attrs:{DeliverdialogVisible:e.DeliverdialogVisible},on:{change:e.DeliverClose}})],1)},o=[],i=l("cebc"),n=l("2f62"),r=l("c1df"),s=l.n(r),u=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-dialog",{staticClass:"Productiondialog2",attrs:{visible:e.DeliverdialogVisible.dialog,title:"发货订单","close-on-click-modal":!1,"before-close":e.close,width:"580px"},on:{"update:visible":function(t){return e.$set(e.DeliverdialogVisible,"dialog",t)}}},[l("div",{staticClass:"Deliverdialog"},[l("el-form",{staticClass:"demo-ruleForm",attrs:{"label-width":"140px"}},[l("el-form-item",{attrs:{label:"名称："}},[l("el-input",{attrs:{disabled:""},model:{value:e.DeliverdialogVisible.obj.product_name,callback:function(t){e.$set(e.DeliverdialogVisible.obj,"product_name",t)},expression:"DeliverdialogVisible.obj.product_name"}})],1),l("el-form-item",{attrs:{label:"工序："}},[l("el-input",{attrs:{disabled:""},model:{value:e.DeliverdialogVisible.obj.procedure_name,callback:function(t){e.$set(e.DeliverdialogVisible.obj,"procedure_name",t)},expression:"DeliverdialogVisible.obj.procedure_name"}})],1),l("el-form-item",{attrs:{label:"数量："}},[l("el-input",{attrs:{disabled:""},model:{value:e.DeliverdialogVisible.obj.number,callback:function(t){e.$set(e.DeliverdialogVisible.obj,"number",t)},expression:"DeliverdialogVisible.obj.number"}})],1)],1),l("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"140px"}},[l("el-form-item",{attrs:{label:"快递类型：",prop:"express_type"}},[l("el-select",{attrs:{filterable:"",placeholder:"快递类型"},model:{value:e.ruleForm.express_type,callback:function(t){e.$set(e.ruleForm,"express_type",t)},expression:"ruleForm.express_type"}},[l("el-option",{attrs:{label:"自运",value:0}}),e._l(e.options,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})],2)],1),"0"==e.ruleForm.express_type?l("el-form-item",{attrs:{label:"GPS：",prop:"gps"}},[l("el-select",{attrs:{filterable:"",placeholder:"GPS"},model:{value:e.ruleForm.gps,callback:function(t){e.$set(e.ruleForm,"gps",t)},expression:"ruleForm.gps"}},e._l(e.options2,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),l("el-form-item",{attrs:{label:"目的地：",prop:"worklist"}},[l("el-select",{attrs:{filterable:"",placeholder:"目的地"},model:{value:e.ruleForm.worklist,callback:function(t){e.$set(e.ruleForm,"worklist",t)},expression:"ruleForm.worklist"}},e._l(e.options1,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),"0"!=e.ruleForm.express_type?l("el-form-item",{attrs:{label:"快递单号：",prop:"express_numbers"}},[l("el-input",{attrs:{maxlength:15,placeholder:"快递单号"},model:{value:e.ruleForm.express_numbers,callback:function(t){e.$set(e.ruleForm,"express_numbers","string"===typeof t?t.trim():t)},expression:"ruleForm.express_numbers"}})],1):l("el-form-item",{attrs:{label:"车牌号：",prop:"vehicle_numbers"}},[l("el-input",{attrs:{maxlength:15,placeholder:"车牌号(自提请输入车牌号)"},model:{value:e.ruleForm.vehicle_numbers,callback:function(t){e.$set(e.ruleForm,"vehicle_numbers","string"===typeof t?t.trim():t)},expression:"ruleForm.vehicle_numbers"}})],1),l("el-form-item",{staticStyle:{"margin-right":"80px"}},[l("el-button",{attrs:{type:"primary",disabled:e.showbbb},on:{click:function(t){return e.getBatch("ruleForm")}}},[e._v("提交发货")])],1)],1)],1)])],1)},c=[],d=(l("7f7f"),{name:"Deliverdialog",components:{},computed:Object(i["a"])({},Object(n["c"])({url:function(e){return e.url}}),Object(n["b"])({token:"getToken"})),props:{DeliverdialogVisible:""},data:function(){return{ruleForm:{express_type:"",express_numbers:"",vehicle_numbers:"",worklist:"",gps:""},rules:{gps:[{required:!0,message:"请选择GPS",trigger:"change"}],worklist:[{required:!0,message:"请选择目的地",trigger:"change"}],express_type:[{required:!0,message:"请选择快递类型",trigger:"change"}],express_numbers:[{required:!0,message:"请填写快递单号",trigger:"change"}],vehicle_numbers:[{required:!1,message:"请填写车牌号",trigger:"change"}]},loading:"",options:[],options1:[],options2:[],showbbb:!1}},methods:{getBatch:function(e){var t=this;this.$refs[e].validate(function(l){if(!l)return!1;t.showbbb=!0;var a={task_id:t.DeliverdialogVisible.obj.id,express_type:t.ruleForm.express_type,express_numbers:t.ruleForm.express_numbers,vehicle_numbers:t.ruleForm.vehicle_numbers,work_shop_id:t.ruleForm.worklist,IMEI:t.ruleForm.gps};t.openFullScreen2(),t.axios({method:"POST",url:t.url+"/api/v1/supplier/send",data:"",params:a,headers:{"content-type":"application/json",token:t.token}}).then(function(e){e&&200==e.data.code&&t.expressadd([t.DeliverdialogVisible.obj.id],{express_type:t.ruleForm.express_type,express_numbers:t.ruleForm.express_numbers,vehicle_numbers:t.ruleForm.vehicle_numbers,work_shop_id:t.ruleForm.worklist,IMEI:t.ruleForm.gps})}).catch(function(l){console.log(l),t.$refs[e].resetFields(),t.showbbb=!1,t.$message({message:t.errmessage(l.response.data),type:"warning"})})})},expressadd:function(e,t){var l=this;l.axios({method:"POST",url:l.url+"/api/v1/express/express-add",data:{task_id:e},params:t,headers:{"content-type":"application/json",token:l.token}}).then(function(e){e&&200==e.data.code&&(l.$message({showClose:!0,message:"发货成功",type:"success"}),l.close(),l.loading.close(),l.$refs["ruleForm"].resetFields())}).catch(function(e){l.loading.close(),l.showbbb=!1,l.$message({message:l.errmessage(e.response.data),type:"warning"})})},getexpress_type:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/express",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var l=t.data.data;e.options=[],l.map(function(t){e.options.push({value:t.id,label:t.name})})}}).catch(function(e){console.log(e)})},getworklist:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/supplier/work-list",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var l=t.data.data;e.options1=[],l.map(function(t){e.options1.push({value:t.id,label:t.name})})}}).catch(function(e){console.log(e)})},getGPSlist:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/gpsbd/list",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var l=t.data.data;e.options2=[],l.map(function(t){e.options2.push({value:t.IMEI,label:t.name})})}}).catch(function(e){console.log(e)})},openFullScreen2:function(){this.loading=this.$loading({lock:!0,text:"发货中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},close:function(){this.options=[],this.options1=[],this.options2=[],this.showbbb=!1,this.$refs.ruleForm.resetFields(),this.$emit("change",!1)}}}),p=d,b=(l("758a"),l("2877")),m=Object(b["a"])(p,u,c,!1,null,"7b3f6378",null),f=m.exports,h=l("9cff"),g={name:"Production",components:{Upfiledialog:h["a"],Deliverdialog:f},computed:Object(i["a"])({},Object(n["c"])({url:function(e){return e.url}}),Object(n["b"])({token:"getToken"})),filters:{formatDate:function(e){return s()(1e3*e).format("YYYY/MM/DD")}},data:function(){return{product_id:"",search_name:"",tableData:{loading:!0,tableList:[],currentPage:1,pageSize:15,total:0},UpfileDialogVisible:{dialog:!1,obj:{}},DeliverdialogVisible:{dialog:!1,obj:{}},allCode:[],codeBtnshow:!1,showbtnbtn:!0}},created:function(){this.product_id=this.$route.query.product_id,this.getProduction()},methods:{getProduction:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/supplier/task-list",data:"",params:{page:e.tableData.currentPage,size:e.tableData.pageSize,product_id:e.product_id},headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var l=t.data.data.list;e.tableData.total=t.data.data.count.total,l.map(function(e){return e.parts_list.length&&e.parts_list.map(function(t){return t.product_name=e.product_name,t}),e.tag="",e}),e.tableData.tableList=l,e.tableData.loading=!1}}).catch(function(t){console.log(t),e.tableData.loading=!1})},filterTag:function(e,t){return t.status===e},searchChange:function(){this.tableData.currentPage=1,this.search_name||(this.search_name=""),this.getProduction()},handleSizeChange:function(e){this.tableData.pageSize=e,this.getProduction()},handleCurrentChange:function(e){this.tableData.currentPage=e,this.getProduction()},clearSearchChange:function(){this.search_name="",this.tableData.currentPage=1,this.getProduction()},Upfile:function(e){e.t=2,e.u=2,this.UpfileDialogVisible.obj=e,this.$refs.upfile.getSingle(e.id),this.UpfileDialogVisible.dialog=!0},showfile:function(e,t){var l=this;l.axios({method:"POST",url:l.url+"/api/v1/supplier/task-preview",data:{parts_id:[]},params:{type:2,task_id:e.id,handle_type:1},headers:{"content-type":"application/json",token:l.token}}).then(function(e){e&&e.data&&200==e.data.code&&console.log(e.data)}).catch(function(e){console.log(e)})},deletfile:function(e){var t=this,l=this.$createElement;t.$msgbox({title:"提示-删除附件",message:l("p",null,[l("span",null,"确认要删除编号"),l("span",{style:"color: teal"},e.id),l("span",null,"名称"),l("span",{style:"color: teal"},e.product_name),l("span",null,"的附件")]),showClose:!1,showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(e,t,l){"confirm"===e?(t.confirmButtonLoading=!0,t.confirmButtonText="删除中...",setTimeout(function(){l(),setTimeout(function(){t.confirmButtonLoading=!1},300)},1e3)):l()}}).then(function(e){})},downCode:function(e,t){var l=this.url;if(e&&t){location.href=l+"/api/v1/supplier/export?type="+t+"&task_id[0]="+e}else this.$message({type:"warning",message:"导出条码出错",offset:300})},handleSelectionChange:function(e){if(e.length>0){this.codeBtnshow=!0;var t="";e.map(function(e,l){e.id&&(t+="&task_id["+l+"]="+e.id)}),this.allCode=t}else this.codeBtnshow=!1,this.allCode=[]},allDownCode:function(e){var t=this.url;console.log(this.allCode,e),location.href=t+"/api/v1/supplier/export?type="+e+this.allCode},downAll:function(){var e=sessionStorage.getItem("Supplierid");e?location.href=this.url+"/api/v1/supplier/export-task?supplier_id="+e+"&name="+this.search_name:this.$message({message:"未知供应商，请检查供应商信息",offset:200})},delivergoods:function(e){this.showbtnbtn&&(this.showbtnbtn=!1,this.DeliverdialogVisible.obj=e,this.$refs.deliver.getexpress_type(),this.$refs.deliver.getworklist(),this.$refs.deliver.getGPSlist(),this.DeliverdialogVisible.dialog=!0)},DeliverClose:function(e){this.DeliverdialogVisible.dialog=e,this.showbtnbtn=!0,this.getProduction()},UpfileClose:function(e){this.UpfileDialogVisible.dialog=e,this.getProduction()},tableheader:function(e){e.row,e.column;var t=e.rowIndex;e.columnIndex;if(0===t)return"height:50px;background:#e5e5e5"}}},_=g,v=(l("d46f"),Object(b["a"])(_,a,o,!1,null,"06615152",null));t["default"]=v.exports},"758a":function(e,t,l){"use strict";var a=l("0696"),o=l.n(a);o.a},d46f:function(e,t,l){"use strict";var a=l("0936"),o=l.n(a);o.a}}]);