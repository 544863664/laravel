(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c6798e68"],{"93b3":function(e,t,a){},"9fdf":function(e,t,a){},a31f:function(e,t,a){"use strict";var l=a("9fdf"),s=a.n(l);s.a},d448:function(e,t,a){"use strict";var l=a("93b3"),s=a.n(l);s.a},ff65:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Delivery"},[a("div",{staticStyle:{"min-height":"720px"}},[a("div",{staticClass:"out_wrap",staticStyle:{"margin-top":"20px"}},[a("el-input",{staticStyle:{width:"auto"},attrs:{"suffix-icon":"el-icon-full-screen",autofocus:"",placeholder:""},on:{input:e.delivecode_Data},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.delivecode_Data(t)}},model:{value:e.delivecode_val,callback:function(t){e.delivecode_val="string"===typeof t?t.trim():t},expression:"delivecode_val"}},[a("el-button",{attrs:{slot:"append",type:"success"},on:{click:e.clear},slot:"append"},[e._v("清除")])],1)],1),a("div",{staticClass:"main_del"},[a("div",{staticClass:"main_title"},[e._v("零件信息")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDatas,height:"65vh"}},[a("el-table-column",{attrs:{prop:"product_name",label:"图样名称"}}),a("el-table-column",{attrs:{prop:"item",label:"图样代号"}}),a("el-table-column",{attrs:{prop:"specs",label:"规格"}}),a("el-table-column",{attrs:{prop:"material",label:"材料"}}),a("el-table-column",{attrs:{prop:"parts_number",label:"条码",width:"90"}}),a("el-table-column",{attrs:{prop:"category",label:"零件编码",width:"90"}}),a("el-table-column",{attrs:{label:"批次",property:"batch"}}),a("el-table-column",{attrs:{prop:"number",label:"库存数量"}}),a("el-table-column",{attrs:{label:"数量",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type&&1==t.row.product_type?a("el-input-number",{attrs:{"controls-position":"right",size:"small",min:0,max:t.row.number,disabled:!1},model:{value:t.row.count,callback:function(a){e.$set(t.row,"count","string"===typeof a?a.trim():a)},expression:"scope.row.count"}}):a("span",[e._v(e._s(t.row.count))])]}}])}),a("el-table-column",{attrs:{label:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,type:"warning"},on:{click:function(a){return e.changeDetale(t.$index)}}},[e._v("删除")])]}}])})],1),a("div",{staticStyle:{"text-align":"right",padding:"15px 0",height:"70px"}},[e.btn?a("el-button",{attrs:{type:"primary",disabled:e.ifBtn},on:{click:e.ondelive}},[e._v("发 货")]):e._e()],1)],1)]),a("Enddev",{ref:"child",attrs:{EnddelivedialogVisible:e.Enddelivedialog},on:{change:e.enddevClose}})],1)},s=[],r=a("cebc"),o=a("2f62"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Enddelive Enddelive"},[a("el-dialog",{attrs:{title:"发货列表",visible:e.EnddelivedialogVisible.dialog,width:"1000px",top:"5vh","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.EnddelivedialogVisible,"dialog",t)},close:e.close}},[a("div",{staticClass:"Enddelivewrap"},[a("el-table",{attrs:{data:e.EnddelivedialogVisible.arr,height:"400",size:"small"}},[a("el-table-column",{attrs:{label:"ID",property:"product_id"}}),a("el-table-column",{attrs:{label:"名称",property:"product_name"}}),a("el-table-column",{attrs:{label:"条码",property:"parts_number"}}),a("el-table-column",{attrs:{label:"编码",property:"category"}}),a("el-table-column",{attrs:{label:"批次",property:"batch"}}),a("el-table-column",{attrs:{label:"数量",property:"count"}})],1),a("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{model:e.ruleForm,rules:e.rules,inline:!0}},[a("el-form-item",{staticStyle:{float:"left"},attrs:{label:"订单填写",prop:"express_type"}},[a("el-select",{staticClass:"kuaidileixing",staticStyle:{width:"130px"},attrs:{filterable:"",placeholder:"快递类型"},model:{value:e.ruleForm.express_type,callback:function(t){e.$set(e.ruleForm,"express_type",t)},expression:"ruleForm.express_type"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),"0"==e.ruleForm.express_type?a("el-form-item",{staticStyle:{float:"left"},attrs:{prop:"gps"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{filterable:"",placeholder:"GPS"},model:{value:e.ruleForm.gps,callback:function(t){e.$set(e.ruleForm,"gps",t)},expression:"ruleForm.gps"}},e._l(e.options2,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),"0"==e.ruleForm.express_type?a("el-form-item",{staticStyle:{float:"left"},attrs:{prop:"vehicle_numbers"}},[a("el-input",{attrs:{maxlength:15,placeholder:"车牌号(自提请输入车牌号)"},model:{value:e.ruleForm.vehicle_numbers,callback:function(t){e.$set(e.ruleForm,"vehicle_numbers","string"===typeof t?t.trim():t)},expression:"ruleForm.vehicle_numbers"}})],1):a("el-form-item",{staticStyle:{float:"left"},attrs:{prop:"express_numbers"}},[a("el-input",{attrs:{maxlength:15,placeholder:"快递单号"},model:{value:e.ruleForm.express_numbers,callback:function(t){e.$set(e.ruleForm,"express_numbers","string"===typeof t?t.trim():t)},expression:"ruleForm.express_numbers"}})],1),a("el-form-item",{staticStyle:{float:"left"},attrs:{prop:"worklist"}},[a("el-select",{staticClass:"chejianmingcehng",attrs:{filterable:"",placeholder:"目的地"},model:{value:e.ruleForm.worklist,callback:function(t){e.$set(e.ruleForm,"worklist",t)},expression:"ruleForm.worklist"}},e._l(e.options1,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",{staticStyle:{float:"right"}},[a("el-button",{on:{click:e.close}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.showbbb},on:{click:function(t){return e.Enddelivedata("ruleForm")}}},[e._v("发 货")])],1)],1)],1)])],1)},i=[],c=(a("7f7f"),a("c1df")),u=a.n(c),d={name:"Enddelive",props:["EnddelivedialogVisible"],computed:Object(r["a"])({},Object(o["c"])({url:function(e){return e.url}}),Object(o["b"])({token:"getToken"})),filters:{formatDate:function(e){return u()(1e3*e).format("YYYY/MM/DD")}},data:function(){return{options:[],options1:[],options2:[],ruleForm:{express_type:"",express_numbers:"",vehicle_numbers:"",worklist:"",gps:""},rules:{gps:[{required:!0,message:"请选择GPS",trigger:"change"}],worklist:[{required:!0,message:"请选择目的地",trigger:"change"}],express_type:[{required:!0,message:"请选择快递类型",trigger:"change"}],express_numbers:[{required:!0,message:"请填写快递单号",trigger:"change"}],vehicle_numbers:[{required:!0,message:"请输入快递单号/车牌号",trigger:"blur"}]},loading:"",showbbb:!1}},methods:{Enddelivedata:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var l=t.EnddelivedialogVisible.arr;if(l.length){t.showbbb=!0;var s={express_type:t.ruleForm.express_type,express_numbers:t.ruleForm.express_numbers,vehicle_numbers:t.ruleForm.vehicle_numbers,work_shop_id:t.ruleForm.worklist,IMEI:t.ruleForm.gps},r=[];l.map(function(e){r.push({product_id:e.product_id,parts_number:e.parts_number,product_name:e.product_name,category:e.category,number:e.count,batch:e.batch})}),t.openFullScreen2(),t.axios({method:"POST",url:t.url+"/api/v1/assemble-send/send",data:{assemble:r},params:s,headers:{"content-type":"application/json",token:t.token}}).then(function(a){a&&200==a.data.code&&(t.$message({showClose:!0,message:"发货成功",type:"success"}),t.close(),t.loading.close(),t.$refs[e].resetFields())}).catch(function(a){console.log(a),t.$message({message:t.errmessage(a.response.data),type:"warning"}),t.loading.close(),t.$refs[e].resetFields(),t.showbbb=!1})}else t.$message({message:"发货数据不能为空",type:"warning"})}})},expressadd:function(e,t){var a=this;a.axios({method:"POST",url:a.url+"/api/v1/express/express-add",data:{task_id:e},params:t,headers:{"content-type":"application/json",token:a.token}}).then(function(e){e&&200==e.data.code&&(a.$message({showClose:!0,message:"发货成功",type:"success"}),a.close(),a.loading.close(),a.$refs["ruleForm"].resetFields())}).catch(function(e){a.loading.close(),a.showbbb=!1,a.$message({message:a.errmessage(e.response.data),type:"warning"})})},getexpress_type:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/express",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var a=t.data.data;e.options.push({value:0,label:"自运"}),a.map(function(t){e.options.push({value:t.id,label:t.name})})}}).catch(function(e){console.log(e)})},getworklist:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/supplier/work-list",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var a=t.data.data;a.map(function(t){e.options1.push({value:t.id,label:t.name})})}}).catch(function(e){console.log(e)})},getGPSlist:function(){var e=this;e.axios({method:"GET",url:e.url+"/api/v1/gpsbd/list",headers:{"content-type":"application/json",token:e.token}}).then(function(t){if(t&&t.data&&t.data.data&&200==t.data.code){var a=t.data.data;e.options2=[],a.map(function(t){e.options2.push({value:t.IMEI,label:t.name})})}}).catch(function(e){console.log(e)})},openFullScreen2:function(){this.loading=this.$loading({lock:!0,text:"发货中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},close:function(){this.$emit("change",!1),this.dialogclose()},dialogclose:function(){this.$refs.ruleForm.resetFields(),this.options=[],this.options1=[],this.options2=[],this.$emit("change",!1)}}},p=d,m=(a("d448"),a("2877")),b=Object(m["a"])(p,n,i,!1,null,"1229afc4",null),h=b.exports,f={name:"Delivery",components:{Enddev:h},data:function(){return{btn:!1,delivecode_val:"",pagesize:15,currpage:1,total:0,tableDatas:[],ifBtn:!1,Enddelivedialog:{dialog:!1,arr:[]}}},computed:Object(r["a"])({},Object(o["b"])({url:"geturl",token:"getToken"})),methods:{delivecode_Data:function(){var e=this;8==e.delivecode_val.length&&e.axios.get(e.url+"/api/v1/assemble-send/obtain",{headers:{"content-type":"application/x-www-form-urlencoded",token:e.token},params:{parts_number:e.delivecode_val}}).then(function(t){if(t&&t.data&&200==t.data.code){var a=t.data.data;a.type;a.count=1,e.tableDatas.push(a),e.delivecode_val="",e.btn=!0;for(var l=0;l<e.tableDatas.length;l++)for(var s=l+1;s<e.tableDatas.length;s++)1==e.tableDatas[l].type&&1==e.tableDatas[l].product_type&&e.tableDatas[l].product_id==e.tableDatas[s].product_id&&e.tableDatas[l].parts_number==e.tableDatas[s].parts_number&&(e.tableDatas[l].count+=1,e.tableDatas.splice(s,1),s--),(2==e.tableDatas[l].type||1==e.tableDatas[l].type&&2==e.tableDatas[l].product_type)&&e.tableDatas[l].product_id==e.tableDatas[s].product_id&&e.tableDatas[l].parts_number==e.tableDatas[s].parts_number&&(e.tableDatas.splice(s,1),e.$message.error(a.product_name+"条码"+a.parts_number+"重复使用"),s--)}}).catch(function(t){e.$message({message:e.errmessage(t.response.data),type:"warning"})})},changeDetale:function(e){this.tableDatas.splice(e,1),0==this.tableDatas.length&&(this.btn=!1)},ondelive:function(){this.tableDatas.length&&(this.Enddelivedialog.arr=this.tableDatas,this.$refs.child.getexpress_type(),this.$refs.child.getworklist(),this.$refs.child.getGPSlist(),this.Enddelivedialog.dialog=!0,this.btn=!1)},enddevClose:function(e){this.Enddelivedialog.dialog=e,this.clear()},clear:function(){this.delivecode_val="",this.tableDatas=[],this.btn=!1}}},g=f,v=(a("a31f"),Object(m["a"])(g,l,s,!1,null,"48c1ee69",null));t["default"]=v.exports}}]);